---
title: critical_service_stopped
description: Detects stopping of critical services including databases, security tools, and backup software.
author: nanos.sh
severity: high
mode: live
detection_mode: scheduled
schedule: "*/2 * * * *"
lookback: 5m
folder: endpoint
mitre_tactics:
  - TA0040
mitre_techniques:
  - T1489
tags:
  - service_stop
  - ransomware_prep
  - windows
ai_triage_hints:
  ignore_when:
    - "Planned maintenance or patching"
    - "Service restart (stop followed by start)"
  suspicious_when:
    - "Multiple critical services stopped"
    - "No corresponding service start"
  context: "Ransomware stops services to unlock files for encryption. Stopping backup and DB services is a strong indicator."
---
source_type=windows_sysmon OR source_type=endpoint_edr
| where action="process_create"
| where (process_name="sc.exe" AND command_line CONTAINS "stop") OR (process_name="net.exe" AND command_line CONTAINS "stop")
| where command_line CONTAINS "sql" OR command_line CONTAINS "backup" OR command_line CONTAINS "vss" OR command_line CONTAINS "exchange" OR command_line CONTAINS "sophos" OR command_line CONTAINS "veeam"
| risk score=70 entity=src_host factor="Critical service stopped"
| where command_line CONTAINS "vss" OR command_line CONTAINS "backup"
| risk score=85 factor="Backup service stopped"
| table timestamp, src_host, user, command_line, risk_score, risk_factors
