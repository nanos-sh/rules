---
title: winrm_remote_execution
description: Detects Windows Remote Management (WinRM) being used for remote command execution.
author: nanos.sh
severity: medium
mode: live
detection_mode: scheduled
schedule: "*/5 * * * *"
lookback: 15m
folder: endpoint
mitre_tactics:
  - TA0008
mitre_techniques:
  - T1021.006
tags:
  - winrm
  - powershell_remoting
  - lateral_movement
  - windows
ai_triage_hints:
  ignore_when:
    - "PowerShell remoting from known management server"
    - "IT admin using Enter-PSSession for management"
  suspicious_when:
    - "WinRM from workstation to server"
    - "Remote session executing suspicious commands"
  context: "WinRM provides PowerShell remoting. Check the remote commands and whether this user normally uses PS remoting."
---
source_type=windows_sysmon OR source_type=endpoint_edr
| where action="process_create"
| where parent_process="wsmprovhost.exe"
| risk score=50 entity=src_host factor="WinRM remote execution"
| where process_name IN ("cmd.exe", "powershell.exe")
| risk score=65 factor="Shell via WinRM"
| where command_line CONTAINS "-enc" OR command_line CONTAINS "IEX" OR command_line CONTAINS "downloadstring"
| risk score=85 factor="Suspicious WinRM payload"
| table timestamp, src_host, user, process_name, command_line, risk_score, risk_factors
