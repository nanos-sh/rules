---
title: ntds_dit_file_access
description: Detects access or copying of the NTDS.dit file which contains all Active Directory password hashes.
author: nanos.sh
severity: critical
mode: live
detection_mode: scheduled
schedule: "*/1 * * * *"
lookback: 5m
folder: endpoint
mitre_tactics:
  - TA0006
mitre_techniques:
  - T1003.003
tags:
  - ntds
  - active_directory
  - credential_dumping
ai_triage_hints:
  ignore_when:
    - "Authorized backup of domain controller"
    - "Known DR replication process"
  suspicious_when:
    - "ntdsutil or vssadmin used to create shadow copy of ntds.dit"
    - "File copied to non-standard location"
  context: "NTDS.dit contains all domain credentials. Unauthorized access means complete domain compromise."
---
source_type=windows_sysmon OR source_type=endpoint_edr
| where action="process_create"
| where (command_line CONTAINS "ntds.dit") OR (process_name="ntdsutil.exe" AND command_line CONTAINS "ifm") OR (command_line CONTAINS "vssadmin" AND command_line CONTAINS "create shadow")
| risk score=90 entity=src_host factor="NTDS.dit access"
| where process_name="ntdsutil.exe" AND command_line CONTAINS "create full"
| risk score=95 factor="NTDS.dit IFM creation"
| table timestamp, src_host, user, process_name, command_line, risk_score, risk_factors
