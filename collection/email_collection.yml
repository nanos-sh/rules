---
title: email_collection_via_powershell
description: Detects PowerShell or scripts accessing mailbox data for email collection.
author: nanos.sh
severity: high
mode: live
detection_mode: scheduled
schedule: "*/5 * * * *"
lookback: 15m
folder: endpoint
mitre_tactics:
  - TA0009
mitre_techniques:
  - T1114.001
tags:
  - email
  - collection
  - powershell
ai_triage_hints:
  ignore_when:
    - "Known email migration or backup tool"
    - "IT admin performing mailbox export"
  suspicious_when:
    - "PowerShell accessing Outlook COM objects"
    - "Large PST files being created"
  context: "Email collection targets sensitive communications. Check if the user has authorization to export mailbox data."
---
source_type=endpoint_edr OR source_type=windows_sysmon
| where action="process_create"
| where process_name="powershell.exe" OR process_name="pwsh.exe"
| where command_line CONTAINS "Outlook.Application" OR command_line CONTAINS "New-PST" OR command_line CONTAINS "Export-Mailbox" OR command_line CONTAINS ".ost" OR command_line CONTAINS ".pst"
| risk score=75 entity=src_host factor="Email collection detected"
| where command_line CONTAINS "GetFolder" OR command_line CONTAINS "Items"
| risk score=85 factor="Mailbox enumeration"
| table timestamp, src_host, user, command_line, risk_score, risk_factors
