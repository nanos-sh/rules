---
title: html_smuggling_detection
description: Detects HTML smuggling where JavaScript in HTML files assembles and drops malicious payloads.
author: nanos.sh
severity: high
mode: live
detection_mode: scheduled
schedule: "*/3 * * * *"
lookback: 10m
folder: endpoint
mitre_tactics:
  - TA0001
  - TA0005
mitre_techniques:
  - T1027.006
tags:
  - html_smuggling
  - phishing
  - evasion
ai_triage_hints:
  ignore_when:
    - "Known web application download behavior"
    - "Legitimate file download from corporate portal"
  suspicious_when:
    - "HTML file creates executable payload"
    - "Browser drops file to Downloads then user executes"
  context: "HTML smuggling bypasses email and proxy security by assembling payloads in the browser. Check what file was dropped."
---
source_type=endpoint_edr OR source_type=windows_sysmon
| sequence by src_host maxspan=5m
    fields(process_name, file_path, command_line, user)
    [action="file_open" file_path CONTAINS ".html" OR file_path CONTAINS ".htm"]
    [file_action="create" file_path=/(\.exe|\.dll|\.iso|\.zip|\.msi)$/i file_path CONTAINS "Downloads"]
| risk score=75 entity=src_host factor="HTML smuggling pattern"
| table timestamp, src_host, step1_user, step1_file_path, step2_file_path, risk_score, risk_factors
