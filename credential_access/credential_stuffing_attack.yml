---
title: credential_stuffing_attack
description: Detects credential stuffing attacks where multiple failed login attempts are followed by a successful login from the same source IP and user combination, characteristic of automated credential testing tools.
author: nanos.sh
severity: high
mode: staging
detection_mode: scheduled
schedule: "*/5 * * * *"
lookback: 15m
folder: identity
mitre_tactics:
  - TA0006
  - TA0001
mitre_techniques:
  - T1110.004
tags:
  - authentication
  - brute_force
  - sequence
ai_triage_hints:
  ignore_when:
    - "User recently requested a password reset"
    - "Source IP is a corporate VPN exit node with multiple users"
    - "Account is a shared service account with expected auth patterns"
  suspicious_when:
    - "Failed attempts use different passwords (visible in auth logs)"
    - "Source IP is from a hosting provider or VPN service"
    - "Activity occurs outside normal business hours"
    - "Multiple users targeted from the same source IP"
  context: "Credential stuffing uses leaked credentials from breaches. Check if the user's email appears in known breach databases. The success after failures suggests valid credentials were found."
---
source_type=auth_logs OR source_type=okta OR source_type=azure_ad
| sequence by user, src_ip maxspan=5m
    fields(user_agent, auth_type, enriched_src_country)
    [action="login" status="failure"]
    [action="login" status="failure"]
    [action="login" status="failure"]
    [action="login" status="success"]
| risk score=70 entity=user factor="Credential stuffing pattern"
| where enriched_src_country != "US" AND enriched_src_country != ""
| risk score=85 factor="Foreign source"
| where sequence_duration < 60
| risk score=90 factor="Rapid sequence"
| table timestamp, user, src_ip, enriched_src_country, user_agent, sequence_duration, risk_score, risk_factors
