---
title: user_logon_script_modification
description: Detects modification of user logon scripts in Active Directory or local policy.
author: nanos.sh
severity: high
mode: live
detection_mode: scheduled
schedule: "*/5 * * * *"
lookback: 15m
folder: identity
mitre_tactics:
  - TA0003
mitre_techniques:
  - T1037.001
tags:
  - logon_script
  - active_directory
  - windows
ai_triage_hints:
  ignore_when:
    - "IT admin updating login scripts through change management"
    - "GPO update deploying new logon script"
  suspicious_when:
    - "Script modified by non-admin account"
    - "Script contains download or execution commands"
  context: "Logon scripts run at every user login. Compromised logon scripts affect all users in scope."
---
source_type=windows_security OR source_type=auth_logs
| where action="directory_modify" OR action="registry_set"
| where command_line CONTAINS "ScriptPath" OR registry_key CONTAINS "\UserInitMprLogonScript" OR file_path CONTAINS "\NETLOGON\"
| risk score=70 entity=src_host factor="Logon script modified"
| where command_line CONTAINS "powershell" OR command_line CONTAINS ".ps1" OR command_line CONTAINS "http"
| risk score=90 factor="Suspicious script content"
| table timestamp, src_host, user, command_line, file_path, registry_key, risk_score, risk_factors
