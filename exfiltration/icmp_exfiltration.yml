---
title: icmp_data_exfiltration
description: Detects large or frequent ICMP traffic that may indicate data exfiltration over ICMP.
author: nanos.sh
severity: medium
mode: live
detection_mode: scheduled
schedule: "*/10 * * * *"
lookback: 30m
folder: network
mitre_tactics:
  - TA0010
mitre_techniques:
  - T1048.003
tags:
  - icmp
  - exfiltration
  - covert
ai_triage_hints:
  ignore_when:
    - "Network monitoring tools using ICMP"
    - "Legitimate ping-based monitoring"
  suspicious_when:
    - "Large ICMP payload sizes"
    - "Continuous ICMP to single destination"
  context: "ICMP can carry data in the payload. Large or frequent ICMP to external IPs is suspicious."
---
source_type=firewall OR source_type=network_flow
| where protocol="icmp"
| where dest_ip!=/^(10\.|192\.168\.|172\.(1[6-9]|2[0-9]|3[01])\.)/
| stats count, sum(bytes_out) as total_bytes by src_ip, dest_ip
| where count > 100 OR total_bytes > 1000000
| risk score=60 entity=src_ip factor="Excessive ICMP traffic"
| where total_bytes > 10000000
| risk score=80 factor="Large ICMP data transfer"
| table timestamp, src_ip, dest_ip, count, total_bytes, risk_score, risk_factors
