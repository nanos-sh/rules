---
title: web_shell_upload_detection
description: Detects web server processes creating suspicious script files that may indicate web shell deployment.
author: nanos.sh
severity: critical
mode: live
detection_mode: scheduled
schedule: "*/2 * * * *"
lookback: 5m
folder: endpoint
mitre_tactics:
  - TA0004
  - TA0003
mitre_techniques:
  - T1505.003
tags:
  - webshell
  - web_server
  - persistence
ai_triage_hints:
  ignore_when:
    - "File is part of normal application deployment"
    - "Web application updating its own files"
  suspicious_when:
    - "Script file created by web server process (w3wp, httpd, nginx)"
    - "File has suspicious name or content patterns"
  context: "Web shells provide persistent remote access through web servers. Check if the server has public-facing vulnerabilities."
---
source_type=endpoint_edr OR source_type=windows_sysmon
| where file_action="create"
| where process_name IN ("w3wp.exe", "httpd.exe", "nginx.exe", "java.exe", "tomcat.exe", "httpd", "nginx", "apache2")
| where file_path=/(\.aspx|\.asp|\.jsp|\.php|\.jspx|\.war)$/i
| risk score=90 entity=src_host factor="Potential web shell uploaded"
| prevalence enrich=true window=30d
| where host_count < 3
| risk score=95 factor="Rare web file from server process"
| table timestamp, src_host, process_name, file_path, file_hash, host_count, risk_score, risk_factors
