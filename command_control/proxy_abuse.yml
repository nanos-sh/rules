---
title: web_proxy_abuse_for_c2
description: Detects suspicious patterns in web proxy traffic that may indicate C2 communications disguised as web traffic.
author: nanos.sh
severity: medium
mode: live
detection_mode: scheduled
schedule: "*/10 * * * *"
lookback: 30m
folder: network
mitre_tactics:
  - TA0011
mitre_techniques:
  - T1090.001
tags:
  - proxy
  - c2
  - network
ai_triage_hints:
  ignore_when:
    - "Known application with frequent API calls"
    - "CDN or analytics traffic"
  suspicious_when:
    - "High frequency to single domain with small payloads"
    - "POST requests with encoded data"
  context: "C2 over HTTPS looks like normal web traffic. Check the destination domain reputation and traffic patterns."
---
source_type=proxy
| where action="connect" AND dest_port=443
| stats count, sum(bytes_out) as total_out, avg(bytes_out) as avg_out, min(timestamp) as timestamp by src_host, dest_host
| where count > 50 AND avg_out < 1000
| prevalence enrich=true window=30d
| where host_count < 5
| risk score=60 entity=src_host factor="Suspicious proxy pattern"
| where host_count < 2
| risk score=80 factor="Rare destination with beacon-like traffic"
| table timestamp, src_host, dest_host, count, total_out, avg_out, host_count, risk_score, risk_factors
