---
title: suspicious_email_attachment_opened
description: Detects opening of email attachments with suspicious file types or from external senders.
author: nanos.sh
severity: medium
mode: live
detection_mode: scheduled
schedule: "*/3 * * * *"
lookback: 10m
folder: endpoint
mitre_tactics:
  - TA0001
mitre_techniques:
  - T1566.001
tags:
  - phishing
  - email
  - attachment
ai_triage_hints:
  ignore_when:
    - "Attachment is from known internal sender"
    - "File type is common document format"
  suspicious_when:
    - "Macro-enabled document (.docm, .xlsm)"
    - "Executable attachment (.exe, .scr, .bat)"
  context: "Email attachments are the primary initial access vector. Check the sender, subject, and file hash."
---
source_type=email_gateway OR source_type=endpoint_edr
| where action="email_received" OR action="file_open"
| where file_path=/(\.docm|\.xlsm|\.pptm|\.xll|\.iso|\.img|\.vhd|\.one|\.url|\.lnk)$/i
| risk score=55 entity=user factor="Suspicious attachment type"
| where file_path=/(\.iso|\.img|\.vhd)$/i
| risk score=75 factor="Container file attachment"
| where file_path CONTAINS ".xll"
| risk score=80 factor="Excel add-in attachment"
| table timestamp, user, src_host, sender, subject, file_path, risk_score, risk_factors
