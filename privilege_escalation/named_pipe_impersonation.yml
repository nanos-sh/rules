---
title: named_pipe_impersonation
description: Detects creation of named pipes commonly associated with privilege escalation tools like PrintSpoofer and RottenPotato.
author: nanos.sh
severity: high
mode: live
detection_mode: scheduled
schedule: "*/3 * * * *"
lookback: 10m
folder: endpoint
mitre_tactics:
  - TA0004
mitre_techniques:
  - T1134.001
tags:
  - named_pipe
  - potato
  - privilege_escalation
  - windows
ai_triage_hints:
  ignore_when:
    - "Pipe is from known application (SQL Server, IIS)"
  suspicious_when:
    - "Pipe name matches known exploit tool patterns"
    - "Created by low-privilege process"
  context: "Named pipe impersonation is used by Potato-family exploits to escalate from service accounts to SYSTEM."
---
source_type=windows_sysmon
| where action="pipe_create"
| where command_line CONTAINS "\pipe\" AND (command_line CONTAINS "spoolss" OR command_line CONTAINS "efsrpc" OR command_line CONTAINS "lsarpc" OR command_line CONTAINS "samr")
| risk score=70 entity=src_host factor="Suspicious named pipe"
| prevalence enrich=true window=30d
| where host_count < 10
| risk score=85 factor="Rare pipe creator"
| table timestamp, src_host, user, process_name, command_line, host_count, risk_score, risk_factors
