---
title: sam_registry_hive_dump
description: Detects dumping of SAM, SYSTEM, or SECURITY registry hives for offline credential extraction.
author: nanos.sh
severity: high
mode: live
detection_mode: scheduled
schedule: "*/2 * * * *"
lookback: 5m
folder: endpoint
mitre_tactics:
  - TA0006
mitre_techniques:
  - T1003.002
tags:
  - sam
  - registry
  - credential_dumping
  - windows
ai_triage_hints:
  ignore_when:
    - "Authorized forensic investigation"
    - "Backup tool saving registry"
  suspicious_when:
    - "SAM and SYSTEM hives saved together"
    - "Exported to user-writable directory"
  context: "SAM + SYSTEM hives allow offline password cracking. Both are needed together to decrypt the hashes."
---
source_type=windows_sysmon OR source_type=endpoint_edr
| where action="process_create"
| where (process_name="reg.exe" AND command_line CONTAINS "save" AND (command_line CONTAINS "sam" OR command_line CONTAINS "system" OR command_line CONTAINS "security"))
| risk score=80 entity=src_host factor="Registry hive dump"
| where command_line CONTAINS "sam" AND command_line CONTAINS "system"
| risk score=95 factor="SAM+SYSTEM dump"
| table timestamp, src_host, user, command_line, risk_score, risk_factors
